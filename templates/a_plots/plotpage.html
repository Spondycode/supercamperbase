{% extends 'base.html' %} {% load static %} {% block content %}
{% load crispy_forms_tags %}

<div class=" container mt-3">
    <div class="row">
        <div class="col-md-8">
            <div class="card shadow m-2 p-2">
                <div class="row text-center">
                    <h3 class="col-sm-8"><i class="bi bi-emoji-sunglasses text-primary"></i> {{ plot.title }}</h3>
                    <a class="col-sm-2 btn btn-secondary btn-sm" href="">
                        {{ plot.categories }} </a>
                </div>
                <hr>

                <p class="text-truncate"><strong>Description:</strong> {{ plot.description }}</p>

                <p><strong>Campsite:</strong> {{ plot.campsite }}</p>
                <p><strong>Price Per Night:</strong> {{ plot.price }}</p>
                <p><strong>Country:</strong> {{ plot.country }}</p>

                {% if plot.what3words is not None %}
                <p class="p-3">Here is a precise what3words address, made of 3 random words. Every 3 metre square in
                    the world has its own unique what3words address.</p>
                <p><strong>What3Words:</strong> <a href="{{ plot.what3words }}"> Get Directions</a> </p>
                {% endif %}
                <p><strong>Plot Poster:</strong> {{ plot.owner }} </p>
                <p><strong>Real Name:</strong> {{ plot.owner.profile.realname }} </p>

                <div>
                    {% if plot.comments.count %}
                    <p class="mt-2"> Comments: <span class="">{{ plot.comments.count }}</span></p>
                    {% else %}
                    <p class="mt-2">Add a Comment below..</p>
                    {% endif %}
                </div>


                
                <p>
                    Likes: {{ plot.likes.count }} {% if user.is_authenticated and user != plot.author %}
                    <a class="btn btn-sm btn-dark" href="{% url 'like_plot' plot.id %}">Add a Like</a>
                </p>
                    
                {% endif %}
                
                
                <figure>
                    <a href="#"><img class="w-100" src="{{ plot.image }}" alt=""></a>
                </figure>



                <div class="d-flex gap-2">

                    {% if user.is_authenticated and user == plot.owner %}

                    <a class="btn btn-outline-warning col" href="{% url 'edit_plot' plot.id %}">Edit Plot</a>
                    <a class="btn btn-outline-danger col" href="{% url 'delete_plot' plot.id %}">Delete Plot</a>
                    {% else %}
                    <a class="btn btn-outline-info col" href="{% url 'home' %}">Home</a>

                    {% endif %}
                </div>
            </div>
            <br>

            {% if user.is_authenticated %}
            <div class="col mt-5">
                <div class="card bg-danger-subtle shadow">
                    <div class="container mt-2">
                        <form method="POST" , action="{% url 'comment_sent' plot.id %}">
                            {% csrf_token %}
                            {{ commentform|crispy }}
                            <button class="btn btn-primary mb-2" type="submit">Add Comment</button>
                        </form>
                    </div>
                </div>

            </div>
            

            {% else %}
            <h3 class="text-center"><a href="{% url 'login' %}">Login</a> If You Want to Make a Comment</h3>
            
            
            <div class="col my-4" id="tab-contents">
                <h3 class="text-center bg-primary-subtle py-3">Comments</h3>
                {% endif %}
                {% for comment in plot.comments.all %}

                {% include 'includes/comment.html' %}
                <br>

                {% endfor %}
            </div>
            
            <div class="col-md-4">
                <div class="row row-cols-md">
                    <div class=" m-2 p-2">
                        {% include 'includes/aside1.html' %}
                        
                        {% include 'includes/aside2.html' %}
                    </div>
                </div>
            </div>
            
        </div>


    </div>
</div>


{% endblock content %}